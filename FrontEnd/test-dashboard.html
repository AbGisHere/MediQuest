<!DOCTYPE html>
<html>
<head>
    <title>Dashboard API Test</title>
</head>
<body>
    <h2>Testing Dashboard API Calls</h2>
    <button onclick="testDashboardAPIs()">Test All Dashboard APIs</button>
    <div id="result"></div>

    <script>
        async function testDashboardAPIs() {
            try {
                // First login
                const loginResponse = await fetch('http://localhost:8000/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'dr_smith', password: 'Doctor@123' })
                });
                const loginData = await loginResponse.json();
                
                if (loginData.access_token) {
                    const token = loginData.access_token;
                    const headers = { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json' 
                    };
                    
                    // Test all dashboard APIs
                    const [patients, vitals, emergencies] = await Promise.all([
                        fetch('http://localhost:8000/patients/?skip=0&limit=10', { headers }),
                        fetch('http://localhost:8000/vitals/aa7e877b-10cd-442b-bd38-b622cecb9629?limit=5', { headers }),
                        fetch('http://localhost:8000/emergency/active', { headers })
                    ]);
                    
                    const patientsData = await patients.json();
                    const vitalsData = await vitals.json();
                    const emergenciesData = await emergencies.json();
                    
                    document.getElementById('result').innerHTML = `
                        <h4>Results:</h4>
                        <p><strong>Patients:</strong> ${patientsData.length} items</p>
                        <p><strong>Vitals:</strong> ${vitalsData.length} items</p>
                        <p><strong>Emergencies:</strong> ${emergenciesData.length} items</p>
                        <details>
                            <summary>Raw Data</summary>
                            <pre>${JSON.stringify({ patients: patientsData, vitals: vitalsData, emergencies: emergenciesData }, null, 2)}</pre>
                        </details>
                    `;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
